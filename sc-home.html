<!--
@license
Copyright (c) 2015 Horacio Ibrahim. All rights reserved.
-->

<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-list/iron-list.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="bower_components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="bower_components/neon-animation/animations/slide-from-left-animation.html">
<link rel="import" href="bower_components/neon-animation/animations/slide-left-animation.html">



<!--
An element providing a solution to no problem in particular.

Example:

    <sc-home></sc-home>

Example:

    <sc-home>
      <h2>Hello sc-home</h2>
    </sc-home>

@demo demo/index.html
@hero hero.svg
-->

<dom-module id="sc-home">
  <template>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
        color: rgba(0,0,0,.75);
        font-family: Roboto;
        font-weight: 300;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        height: 100%;
      }
      /* News */
      .list-container {
        height: 100%;
        width: 100%;
        overflow-y: scroll;
      }
      .service-item {
        @apply(--layout-vertical);
        border-bottom: 1px solid rgba(0, 0, 0, 0.09);
        padding-bottom: 5px;
        padding-top: 5px;
        padding-left: 8px;
        padding-right: 6px;
        cursor: pointer;
        height: 90px;
        text-overflow:ellipsis;
      }
      /* hover for desktop */
      .service-item.selected {
        background-color: rgba(19,95,184,.75);
        color: white !important;
      }
      .service-item.selected .service-item-subheader span {
        color: white;
      }
      .service-item.selected .service-item-body {
        color: rgba(255, 255, 255, 0.34);
      }
      .service-item.selected .new-message {
        background-color: #7ED321;
      }
      .service-item-headers {
        @apply(--layout-horizontal);
      }
      .service-item-header {

      }
      .service-item-header h3 {
        margin-top: 2px;
        margin-bottom: 2px;
        font-size: 1em;
        font-weight: 300;
      }
      .service-item-subheader span, .service-item-subheader div {
        padding: 5px 10px 5px 0px;
        color: #000;
        opacity: 0.54;
        font-size: 12px;
        margin-top: -5px;
      }
      .service-counter {
        font-size: 13px;
        width: 22px;
        height: 18px;
        text-align: center;
        margin-top: 1px;
        margin-bottom: -6px;
        margin-left: 10px;
        margin-right: 5px;
        -webkit-border-radius: 3px;
        -moz-border-radius: 3px;
        border-radius: 3px;
        background: #CCC;
        padding-top: 2px;
        color: #FFF;
      }
      .service-counter.new-message{
        background: #4A90E2;
        color: #FFF;
        border: 1px solid rgba(19, 95, 184 0.8);
      }
      .flexchild {
        @apply(--layout-flex);
      }
      .service-item-body {
        overflow: hidden;
        font-size: 14px;
        line-height: 17px;
        padding-bottom: 5px;
        color: rgba(0,0,0,0.38);
      }
      .avatarBox {
        float:left;
        width: 32px;
        height: 32px;
        -webkit-border-radius: 6px; /* Can also be 55px */
        -moz-border-radius: 6px;
        border-radius: 6px;
        margin-right: 6px;
       }
      .avatarBox img {
        width: 32px;
        height: 32px;
        -webkit-border-radius: 6px; /* Can also be 50px */
        -moz-border-radius: 6px;
        border-radius: 6px;
        opacity: 0.8;
       }
    </style>
    <iron-ajax
      url="http://localhost:8081/demo/data_home.json"
      on-response="ajaxResponse"
      handle-as="json"
      auto></iron-ajax>
    <!-- Start: html common -->
    <div class="list-container">
      <iron-list id="itemsList" items="{{documents}}" as="item" selected-item="{{selectedItem}}">
        <template>
            <div tabindex="0" on-tap="selectItem" aria-label$="[[_getAriaLabel(item, selected)]]" class$="[[_computedClass(selected)]]">
              <!-- div header -->
              <div class="service-item-headers service-item-header">
                <div class="flexchild"><h3>[[item.service]]</h3></div>
                <div><div class="service-counter new-message">[[item.opened_ticket]]</div></div>
              </div>
              <!-- div subheader -->
              <div class="service-item-headers service-item-subheader">
                <span>[[item.hashtag]]</span>
                <!-- colocar um filter momentjs aqui quando integrado com meteor -->
                <span>[[item.lastMessage.timestamp]]</span>
              </div>
              <!-- div message -->
              <div class="service-item-body">
                <template is="dom-if" if="{{item.lastMessage.user.avatar}}">
                  <div class="avatarBox">
                    <img src="[[item.lastMessage.user.avatar]]">
                  </div>
                </template>
                [[item.lastMessage.body]]</div>
            </div>
        </template>
      </iron-list>

    </div>
    <!-- End: html common -->
  </template>

  <script>
    Polymer({
      is: 'sc-home',
      behaviors: [Polymer.NeonAnimatableBehavior],
      properties: {
        animationConfig: {
          value: function() {
            return {
              'entry': {
                name: 'slide-from-left-animation',
                node: this
              },
              'exit': {
                name: 'slide-left-animation',
                node: this
              }
            }
          }
        },
        selectedItem: {
          type: Object
        },
        /**
         * `document` array content the items for iron-list.
         */
        documents: {
          type: Object,
        },

        /**
         * `fancy` indicates that the element should don a monocle and tophat,
         * while checking its pocket watch.
         */
        fancy: Boolean,
      },

      // Element Lifecycle

      ready: function() {
        // `ready` is called after all elements have been configured, but
        // propagates bottom-up. This element's children are ready, but parents
        // are not.
        //
        // This is the point where you should make modifications to the DOM (when
        // necessary), or kick off any processes the element wants to perform.
      },

      attached: function() {
        // `attached` fires once the element and its parents have been inserted
        // into a document.
        //
        // This is a good place to perform any work related to your element's
        // visual state or active behavior (measuring sizes, beginning animations,
        // loading resources, etc).
      },

      detached: function() {
        // The analog to `attached`, `detached` fires when the element has been
        // removed from a document.
        //
        // Use this to clean up anything you did in `attached`.
      },
      // Ajax response
      ajaxResponse: function(event, response, third) {
          this.documents = event.detail.response;
      },
      // Selection Behavior
      selectItem: function(e) {
         this._selectItem(e);
       },
       /* `_selectItem` select or unselect item
       *
       */
      _selectItem: function(e){
        if (this.$.itemsList.selectedItem == e.model.item) {
            // unselect
            this._unselect(e);
            this._computedClass(false);
        } else {
            this.$.itemsList.selectItem(e.model.item);    
        }
      },
      _unselect: function(e) {
         this.$.itemsList.deselectItem(e.model.item);
       },
      _computedClass: function(isSelected) {
        var classes = 'service-item';
        if (isSelected) {
          classes += ' selected';
        }
        return classes;
      },
      _getAriaLabel: function(item, selected) {
        return selected ? 'Deselect ' + item.hashtag : 'Select ' + item.hashtag;
      }

    });
  </script>
</dom-module>
